<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="author" content="José Augusto <joseaugustodearaujonascimento@gmail.com>">
        <title>Web Game</title>
        <link rel="stylesheet" href="https://code.getmdl.io/1.1.1/material.deep_purple-indigo.min.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
        <link href='https://fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=en' rel='stylesheet' type='text/css'>
        <script defer src="https://code.getmdl.io/1.1.1/material.min.js"></script>
        <script>
'use strict';

var _ns = {
    fn: {
        alert: function(what) {
            // console.log(what); },
            window.alert(what); },
        prompt: function(what) {
            return window.prompt(what); }},
        byId: function(id) {
            return document.getElementById(id); },
        byClass: function(className) {
            return document.getElementsByClassName(className); },
    Model: {},
    CurrentGame: null,
    Stats: {
        GamesPlayed: 0,
        Acertos: 0,
        Erros: 0 } };

(function($) {
    var OP_ADICAO = '+';
    var OP_SUBTRACAO = '-';
    var OP_MULTIPLICACAO = '*';
    var OP_DIVISAO = '/';
    var OP_NOOP = '';

    var IMPL_OP_NUM = 4;
    var IMPL_N_DEFAULT_QUESTIONS = 10;
    
    $.Game = (function Game() {
        var _game = $.Model.Game.novo(IMPL_N_DEFAULT_QUESTIONS);
        var _questionIdx = 0;
        var _stats = {
            Acertos: 0,
            Erros: 0 };

        this.getCurrentQuestion = function() {
            return _game.questions[_questionIdx]; };

        this.getStats = function() {
            return _stats;
        };

        this.start = function() {
            _game.currentQuestion = _game.questions[0]; };

        this.answer = function() {
            if (this.isEndOfGame()) {
                return; }

            var q = this.getCurrentQuestion();
            var r = parseFloat($.byId('resultado').value);
            var correto = q.resultado() == r;

            // console.log(correto);

            this.nextQuestion();

            this.getStats().Acertos += correto ? 1 : 0;
            this.getStats().Erros += !correto ? 1 : 0;

            if (!this.isEndOfGame()) {
                this.display(this.getCurrentQuestion());
            } else {
                this.endOfGame();
            }
        };

        this.nextQuestion = function() {
            _questionIdx++; };

        this.isEndOfGame = function() {
            return _questionIdx >= _game.questions.length; };

        this.endOfGame = function() {
            var Question = $.Model.Question;

            $.Stats.GamesPlayed++;
            $.Stats.Acertos += $.CurrentGame.getStats().Acertos;
            $.Stats.Erros += $.CurrentGame.getStats().Erros;

            $.Game.displayStats();

            this.display(new Question(OP_ADICAO));
        };

        this.display = function(q) {
            var r = $.byId('resultado');

            $.byId('termo1').value = q.operador1;
            $.byId('operacao').value = q.operacao;
            $.byId('termo2').value = q.operador2;
            r.value = "";

            r.focus(); };
    });

    $.Game.novo = function() {
        var curr = new $.Game();

        $.CurrentGame = curr;

        curr.start();
        curr.display(curr.getCurrentQuestion());

        $.Game.displayStats(); };

    $.Game.displayStats = function() {
        var s = $.Stats;

        $.byId('statsText').innerHTML = '<strong>Jogos:</strong> ' + s.GamesPlayed + '<br>' +
            '<strong>Erros:</strong> ' + s.Erros + '<br>' +
            '<strong>Acertos:</strong> ' + s.Acertos + '<br>';
    };

    $.Util = new (function Util() {
        this.rand = function(min, max) {
            return Math.floor(min + (Math.random() * (max - min + 1))); };

        this.parseOperacao = function(i) {
            return new $.Model.Operacao(this.parseOperador(i)); };

        this.parseOperador = function(i) {
            switch (i) {
                case 0:
                    return OP_ADICAO;
                case 1:
                    return OP_SUBTRACAO;
                case 2:
                    return OP_MULTIPLICACAO;
                case 3:
                    return OP_DIVISAO;
                default:
                    return OP_NOOP;
            }
        };
    });

    $.Model.Operacao = (function Operacao(opChar) {
        var opFuncs = {};
        opFuncs[OP_ADICAO] = function(p1, p2) {
            return p1 + p2; };
        opFuncs[OP_SUBTRACAO] = function(s, m) {
            return s - m; };
        opFuncs[OP_MULTIPLICACAO] = function(p1, p2) {
            return p1 * p2; };
        opFuncs[OP_DIVISAO] = function(d1, d2) {
            return d1 / d2; };

        this.opChar = opChar;

        this.isDivisao = function() {
            return this.opChar == OP_DIVISAO; };

        this.isSubtracao = function() {
            return this.opChar == OP_SUBTRACAO; };

        this.eval = function(op1, op2) {
            var fun = opFuncs[this.opChar];

            return fun(op1, op2); };

        this.toString = function() {
            return this.opChar; };

        this.equals = function(other) {
            return typeof(this) == typeof(other) ||
                this.opChar == other.opChar; };
    });

    $.Model.Question = (function Question(operacao) {
        var Operacao = $.Model.Operacao;

        this.operador1 = null;
        this.operacao = operacao;
        this.operador2 = null;

        this.resultado = function() {
            return this.operacao.eval(
                this.operador1,
                this.operador2); };
        
        this.equals = function(other) {
            return typeof(this) == typeof(other) &&
                this.operador1 == other.operador1 &&
                this.operacao.equals(other.operacao) &&
                this.operador2 == other.operador2; };

        this.toString = function() {
            return this.operador1 + this.operacao + this.operador2; };
    });

    $.Model.Game = (function Game(){
        var Util = $.Util;
        var Question = $.Model.Question;

        this.questions = [];

        this.contains = function(q) {
            for (var i = 0; i < this.questions.length; i++) {
                if (this.questions[i].equals(q)) {
                    return true; }}
            return false;
        };
    });

    $.Model.Game.randQuestion = function(op) {
        var Question = $.Model.Question;
        var Util = $.Util;

        var q = new Question(Util.parseOperacao(op));

        q.operador1 = Util.rand(1, 9);
        q.operador2 = Util.rand(1, 9);

        if (q.operacao.isDivisao()) {
            q.operador1++;
            q.operador1 = q.operador2 * q.operador1;
        } else if (q.operacao.isSubtracao()) {
            var tmp = q.operador1;

            q.operador1 = Math.max(
                q.operador1,
                q.operador2);
            q.operador2 = Math.min(
                tmp,
                q.operador2);
        }

        return q; };

    $.Model.Game.novo = function(n) {
        var Game = $.Model.Game;

        var i;
        var op;
        var q;
        var g = new Game();

        g.questions = [];

        if (n == null) {
            n = IMPL_N_DEFAULT_QUESTIONS; }

        for (op = 0; op < IMPL_OP_NUM; op++) {
            i = 0;

            while (i < n) {
                q = Game.randQuestion(op);

                if (!g.contains(q)) {
                    // $.fn.alert(q.toString() + "=" + q.resultado());

                    g.questions.push(q);
                    i++; }}
        }

        return g; };

    $.Tabuada = function(n) {
        var cont = $.byId('tabuadaContent');

        cont.innerHTML = "";

        for (var i = 1; i <= 10; i++) {
            cont.innerHTML += n + " + " + i + " = " + (n + i) + "<br>"; }

        $.byId('tabuadaDialog').showModal(); };

    window.onhashchange = function() {
        var hash = '#welcome';

        if (window.location.hash.length > 0) {
            hash = window.location.hash; }

        var id = hash.substr(1);
        var pages = $.byClass('page');
        var page;
        var i;

        for (i = 0; i < pages.length; i++) {
            page = pages[i];

            page.style.display = "none"; }

        page = $.byId(id);

        if (page != null) {
            page.style.display = "block"; }
    };
})(_ns);
        </script>
    </head>
    <style>
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0; }
        input {
            width: 6rem;
            height: 6rem;
            text-align: center;
            margin: 0;
            padding: 0;
            font-size: 120%;
            border-width: 0;
            border: none;
            outline: none; }
        input[readonly] {
            border: none; }
        .operador {
            width: 2rem; }
        .page {
            display: none; }
        .mdl-card__actions {
            text-align: right; }
        .mdl-card__supporting-text {
            text-indent: 2rem; }
        @media (max-width: 759px) {
            input {
                width: 3.6rem;
                height: 4rem;
                font-size: 40px !important; }
            .operador {
                font-size: 34px !important;
                width: 1.2rem; }}
    </style>
    <body class="mdl-color--grey-100 mdl-color-text--grey-700" onload="window.onhashchange();">
        <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header mdl-layout--fixed-drawer">
            <header class="mdl-layout__header">
                <div class="mdl-layout__header-row">
                    <span class="mdl-layout-title">
                        Math Game</span>
                    <div class="mdl-layout-spacer"></div>
                </div>
            </header>
            <div class="mdl-layout__drawer">
                <span class="mdl-layout-title">
                    Math Game</span>
                <nav class="mdl-navigation">
                    <a class="mdl-navigation__link" href="#games">
                        Jogos</a>
                    <a class="mdl-navigation__link" href="#stats">
                        Estatísticas</a>
                    <a class="mdl-navigation__link" href="#tabuadas">
                        Tabuadas</a>
                </nav>
            </div>
            <main class="mdl-layout__content">
                <div class="page-content">
                    <div id="welcome" class="page mdl-grid" style="display: block;">
                        <div class="mdl-cell mdl-cell--12-col mdl-card mdl-shadow--4dp">
                            <div class="mdl-card__title mdl-card--expand">
                                <h4> :: Bem vindo :: </h4>
                            </div>
                            <div class="mdl-card__supporting-text mdl-typography--text-justify">
                                Seja bem vindo, nesse site você poderá expandir seus conhecimentos nas operações da matemática, assim como jogar e se divertir.
                            </div>
                            <div class="mdl-card__actions">
                            </div>
                        </div>
                    </div>
                    <div id="games" class="page mdl-grid">
                        <div class="mdl-cell mdl-cell--12-col mdl-card mdl-shadow--4dp">
                            <div class="mdl-card__title mdl-card--expand">
                                <h5>Resolução :: Operações</h5>
                            </div>
                            <div class="mdl-card__supporting-text">
                                <div class="" style="text-align: center">
                                    <form id="questao" action="javascript:void(0);" method="get" onsubmit="_ns.CurrentGame.answer();">
                                        <input id="termo1" class="mdl-typography--display-3" type="number" value="" max="99" min="0" maxlength="2" tabindex="1" placeholder="?" autofocus>
                                        <input id="operacao" class="operador mdl-typography--display-3" type="text" value="+" readonly>
                                        <input id="termo2" class="mdl-typography--display-3" type="number" value="" max="99" min="0" maxlength="2" tabindex="2" placeholder="?" >
                                        <input id="operador" class="operador mdl-typography--display-3" type="text" value="=" readonly>
                                        <input id="resultado" class="mdl-typography--display-3" type="number" value="" max="99" min="0" maxlength="2" tabindex="3" placeholder="?" >
                                    </form>
                                </div>
                            </div>
                            <div class="mdl-card__actions">
                                <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-right" onclick="_ns.CurrentGame.answer();" form="questao">
                                    Responder
                                </button>
                                <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-right" onclick="_ns.Game.novo();">
                                    Novo Jogo
                                </button>
                            </div>
                        </div>
                    </div>
                    <div id="tabuadas" class="page mdl-grid">
                        <div class="mdl-cell mdl-cell--12-col mdl-card mdl-shadow--4dp">
                            <div class="mdl-card__title mdl-card--expand">
                                <h5>Tabuadas</h5>
                            </div>
                            <div class="mdl-card__supporting-text">
                                Clique em um número abaixo para exibir sua tabuada
                            </div>
                            <dialog id="tabuadaDialog" class="mdl-dialog">
                                <h5 class="mdl-dialog__title">Tabuada</h5>
                                <div class="mdl-dialog__content">
                                  <p id="tabuadaContent">
                                  <p>
                                </div>
                                <div class="mdl-dialog__actions">
                                  <button id="tabuadaClose" type="button" class="mdl-button close" onclick="_ns.byId('tabuadaDialog').close();">
                                    Ok
                                  </button>
                                </div>
                            </dialog>
                            <div class="mdl-card__actions">
                                <button class="mdl-button mdl-js-button mdl-button--fab mdl-button--raised mdl-js-ripple-effect mdl-button--colored" onclick="_ns.Tabuada(1);">
                                  <i>1</i>
                                </button>
                                <button class="mdl-button mdl-js-button mdl-button--fab mdl-button--raised mdl-js-ripple-effect mdl-button--colored" onclick="_ns.Tabuada(2);">
                                  <i>2</i>
                                </button>
                                <button class="mdl-button mdl-js-button mdl-button--fab mdl-button--raised mdl-js-ripple-effect mdl-button--colored" onclick="_ns.Tabuada(3);">
                                  <i>3</i>
                                </button>
                                <button class="mdl-button mdl-js-button mdl-button--fab mdl-button--raised mdl-js-ripple-effect mdl-button--colored" onclick="_ns.Tabuada(4);">
                                  <i>4</i>
                                </button>
                                <button class="mdl-button mdl-js-button mdl-button--fab mdl-button--raised mdl-js-ripple-effect mdl-button--colored" onclick="_ns.Tabuada(5);">
                                  <i>5</i>
                                </button>
                                <button class="mdl-button mdl-js-button mdl-button--fab mdl-button--raised mdl-js-ripple-effect mdl-button--colored" onclick="_ns.Tabuada(6);">
                                  <i>6</i>
                                </button>
                                <button class="mdl-button mdl-js-button mdl-button--fab mdl-button--raised mdl-js-ripple-effect mdl-button--colored" onclick="_ns.Tabuada(7);">
                                  <i>7</i>
                                </button>
                                <button class="mdl-button mdl-js-button mdl-button--fab mdl-button--raised mdl-js-ripple-effect mdl-button--colored" onclick="_ns.Tabuada(8);">
                                  <i>8</i>
                                </button>
                                <button class="mdl-button mdl-js-button mdl-button--fab mdl-button--raised mdl-js-ripple-effect mdl-button--colored" onclick="_ns.Tabuada(9);">
                                  <i>9</i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div id="stats" class="page mdl-grid">
                        <div class="mdl-cell mdl-cell--12-col mdl-card mdl-shadow--4dp">
                            <div class="mdl-card__title mdl-card--expand">
                                <h5>Estatísticas do Jogo</h5>
                            </div>
                            <div class="mdl-card__supporting-text">
                                <span id="statsText"></span>
                            </div>
                            <div class="mdl-card__actions">
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </body>
</html>
